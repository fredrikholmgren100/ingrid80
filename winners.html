<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ingrid 80 ‚Äî Vinnarna!</title>
  <style>
    :root {
      --accent: #6C63FF;
      --gold: #FFD700;
      --silver: #C0C0C0;
      --bronze: #CD7F32;
      --bg-zoom: 180%;
      --bg-pos-x: 50%;
      --bg-pos-y: 50%;
    }
    body {
      margin: 0;
      overflow: hidden;
      background-color: #1d1f27;
      font-family: 'Segoe UI', Arial, sans-serif;
      color: white;
      text-align: center;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    .background {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: url("letsboat-bg.png") center center no-repeat;
      background-size: var(--bg-zoom);
      background-position: var(--bg-pos-x) var(--bg-pos-y);
      filter: brightness(0.5) blur(3px);
      z-index: -1;
    }

    h1 {
      font-size: 3em;
      color: var(--gold);
      letter-spacing: 1px;
      margin-bottom: 40px;
    }

    #revealBtn {
      padding: 20px 40px;
      font-size: 2em;
      background: var(--accent);
      border: none;
      border-radius: 12px;
      color: white;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
      transition: 0.3s;
    }
    #revealBtn:hover {
      transform: scale(1.08);
    }

    .winner-container {
      margin-top: 40px;
      width: 100%;
      max-width: 700px;
      display: none;
    }

    .winner {
      opacity: 0;
      transform: scale(0.8);
      margin: 40px 0;
      transition: transform 1s ease, opacity 1s ease;
      font-size: 2.2em;
    }

    .winner.visible {
      opacity: 1;
      transform: scale(1);
    }

    .place {
      font-size: 1.4em;
      margin-bottom: 10px;
    }

    .name {
      font-size: 2.8em;
      font-weight: bold;
      text-shadow: none;
    }

    .bronze .name { color: var(--bronze); }
    .silver .name { color: var(--silver); }
    .gold .name { color: var(--gold); }

    @keyframes confetti {
      0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    .confetti {
      position: fixed;
      width: 12px; height: 12px;
      top: 0; left: 50%;
      opacity: 0;
      animation: confetti 3s ease-out forwards;
    }

    footer {
      position: absolute;
      bottom: 20px;
      width: 100%;
      text-align: center;
      color: #ccc;
      font-size: 1.2em;
    }

    /* üîπ Other players: centered between left edge and winners, same height */
    #others {
      position: fixed;
      top: 50%;
      left: 25%; /* halfway between 0% and 50% */
      transform: translate(-50%, -50%);
      text-align: left;
      font-size: 1.1em;
      display: none;
      max-width: 280px;
      z-index: 1;
    }

    .others-title {
      font-size: 1.5em;
      margin-bottom: 10px;
      color: #FFD700;
    }

    .others-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .others-list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 10px;
      margin-bottom: 6px;
      background: rgba(0, 0, 0, 0.45);
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
    }

    .others-rank {
      opacity: 0.85;
      min-width: 50px;
    }

    .others-name {
      font-weight: 600;
      flex: 1;
      margin: 0 6px;
    }

    .others-points {
      color: #FFD700;
      font-weight: 600;
      white-space: nowrap;
    }

    @media (max-width: 600px) {
      #others {
        font-size: 1em;
        max-width: 230px;
        left: 30%;
      }
    }

    /* üîπ Hacking overlay */
    .hack-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
      font-family: "Consolas", "Courier New", monospace;
    }

    .hack-box {
      width: 90%;
      max-width: 500px;
      background: #050810;
      border: 1px solid #00ff88;
      border-radius: 8px;
      padding: 18px 20px;
      box-shadow: 0 0 18px rgba(0, 255, 136, 0.4);
      color: #00ff88;
    }

    .hack-title {
      margin-bottom: 10px;
      font-weight: 700;
      font-size: 1.1em;
    }

    .hack-progress-bar {
      width: 100%;
      height: 14px;
      border-radius: 999px;
      background: rgba(0, 255, 136, 0.12);
      overflow: hidden;
      margin: 10px 0 14px;
      border: 1px solid rgba(0,255,136,0.6);
    }

    .hack-progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #00ff88, #00ffaa);
      transition: width 0.2s linear;
    }

    .hack-log {
      font-size: 0.95em;
      max-height: 120px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .hack-log-line {
      margin-bottom: 4px;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <div class="background"></div>

  <h1>üèÜ Och vinnarna √§r...</h1>

  <button id="revealBtn">Klicka f√∂r att visa 3:e plats</button>

  <div class="winner-container" id="winnersBox" style="display:none;">
    <div id="bronze" class="winner bronze">
      <div class="place">ü•â 3:e plats</div>
      <div class="name">...</div>
    </div>
    <div id="silver" class="winner silver">
      <div class="place">ü•à 2:a plats</div>
      <div class="name">...</div>
    </div>
    <div id="gold" class="winner gold">
      <div class="place">ü•á 1:a plats</div>
      <div class="name">...</div>
    </div>
  </div>

  <!-- üîπ Other players list -->
  <div id="others"></div>

  <!-- üîπ Hacking overlay -->
  <div class="hack-overlay" id="hackOverlay">
    <div class="hack-box">
      <div class="hack-title">[ ACCESSING VIKING LINE SYSTEMS... ]</div>
      <div class="hack-progress-bar">
        <div class="hack-progress-fill" id="hackProgressFill"></div>
      </div>
      <div class="hack-log" id="hackLog"></div>
    </div>
  </div>

  <footer>üéâ Grattis till alla deltagare! Tack f√∂r att ni firade Ingrid 80! üéÇ</footer>

  <script>
    const API_URL = "https://api.sheety.co/19d52e6f83ab4563121d3da380c48d62/bingoPlayers/blad1";

    let allRanked = [];
    let step = 0;

    // üìä Read from the "points" column in Blad1
    async function loadResults() {
      const res = await fetch(API_URL);
      const data = await res.json();
      const sheetKey = Object.keys(data)[0];
      const players = data[sheetKey] || [];

      const results = players
        .map(p => {
          const totalPoints = Number(p.points) || 0; // <- read from sheet
          return {
            name: p.name || "(ok√§nt namn)",
            totalPoints
          };
        })
        // optional: keep everyone, even 0 points; remove this filter if you want truly all
        .filter(p => p.name.trim() !== "");

      results.sort((a, b) => b.totalPoints - a.totalPoints);
      return results;
    }

    function revealTop3() {
      const top3 = allRanked.slice(0, 3);

      // Safety: if fewer than 3 players
      if (top3.length < 3) return;

      document.querySelector("#bronze .name").textContent =
        `${top3[2].name} (${top3[2].totalPoints} p)`;
      document.querySelector("#silver .name").textContent =
        `${top3[1].name} (${top3[1].totalPoints} p)`;
      document.querySelector("#gold .name").textContent =
        `${top3[0].name} (${top3[0].totalPoints} p)`;
    }

    function showOthers() {
      const othersDiv = document.getElementById("others");
      const others = allRanked.slice(3);
      if (!others.length) return;

      othersDiv.style.display = "block";
      othersDiv.innerHTML = `
        <div class="others-title">√ñvriga deltagare</div>
        <ul class="others-list">
          ${others.map((p,i)=> `
            <li>
              <span class="others-rank">#${i+4}</span>
              <span class="others-name">${p.name}</span>
              <span class="others-points">${p.totalPoints} p</span>
            </li>
          `).join("")}
        </ul>
      `;
    }

    function dropConfetti() {
      for (let i = 0; i < 120; i++) {
        const confetti = document.createElement("div");
        confetti.className = "confetti";
        confetti.style.left = Math.random()*100 + "%";
        confetti.style.background = ["#FFD700","#C0C0C0","#CD7F32","#6C63FF"][Math.floor(Math.random()*4)];
        confetti.style.animationDelay = Math.random() * 1 + "s";
        document.body.appendChild(confetti);
        setTimeout(()=>confetti.remove(), 3500);
      }
    }

    // üîπ Fake hacking sequence (10 seconds)
    function startHackingSequence(onDone) {
      const overlay = document.getElementById("hackOverlay");
      const log = document.getElementById("hackLog");
      const fill = document.getElementById("hackProgressFill");

      overlay.style.display = "flex";
      log.innerHTML = "";
      fill.style.width = "0%";

      const messages = [
        "Accessing data...",
        "Hacking Viking Line database...",
        "Decrypting secret cabin lists...",
        "Adding cheating points...",
        "Recalculating leaderboards...",
        "Almost done...",
        "Done! Showing final winner..."
      ];

      const totalDuration = 10000; // 10 seconds
      const tick = 200;            // progress update every 0.2s
      let elapsed = 0;

      // Show messages at evenly spaced intervals
      messages.forEach((msg, i) => {
        const t = (totalDuration / (messages.length)) * i;
        setTimeout(() => {
          const line = document.createElement("div");
          line.className = "hack-log-line";
          line.textContent = msg;
          log.appendChild(line);
          log.scrollTop = log.scrollHeight;
        }, t);
      });

      const progressTimer = setInterval(() => {
        elapsed += tick;
        let progress = Math.min(100, (elapsed / totalDuration) * 100);
        fill.style.width = progress + "%";
        if (elapsed >= totalDuration) {
          clearInterval(progressTimer);
          setTimeout(() => {
            overlay.style.display = "none";
            if (typeof onDone === "function") onDone();
          }, 400); // tiny pause after 100%
        }
      }, tick);
    }

    document.getElementById("revealBtn").addEventListener("click", async () => {
      const btn = document.getElementById("revealBtn");

      if (step === 0) {
        allRanked = await loadResults();
        if (allRanked.length < 3) {
          alert("Det finns inte minst tre spelare med po√§ng √§nnu.");
          return;
        }

        revealTop3();
        document.getElementById("winnersBox").style.display = "block";
        document.getElementById("bronze").classList.add("visible");
        btn.textContent = "Visa 2:a plats";
        step = 1;

      } else if (step === 1) {
        document.getElementById("silver").classList.add("visible");
        btn.textContent = "Visa vinnaren!";
        step = 2;

      } else if (step === 2) {
        // üîπ Start hacking joke instead of showing winner immediately
        btn.disabled = true;
        startHackingSequence(() => {
          document.getElementById("gold").classList.add("visible");
          dropConfetti();
          btn.style.display = "none";
          step = 3;
          setTimeout(showOthers, 3000);
        });
      }
    });
  </script>
</body>
</html>
