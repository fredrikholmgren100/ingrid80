<!doctype html>
<html lang="sv">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1d1f27">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Din Speldashboard</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #1d1f27;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    .container {
      width: 100%;
      max-width: 400px;
      text-align: center;
      margin-top: 60px; /* space for menu button */
    }
    h1 {
      font-size: 1.8em;
      margin-bottom: 10px;
    }
    .timer {
      font-size: 1.2em;
      margin: 15px 0;
      font-weight: bold;
      color: #ffd700;
    }
    .game-card {
      background: #2a2d38;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      text-align: center;
      margin-top: 20px;
    }
    button {
      margin-top: 10px;
      background: #6C63FF;
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background: #5a54d6;
    }

    .welcome-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 10px;
    }
    .welcome-wrapper h1 {
      margin: 0;
      font-size: 1.8em;
    }
    .welcome-img {
      width: 60px;
      height: 60px;
    }

    /* Hamburger button */
    .menu-btn {
      position: fixed;
      top: 15px;
      left: 15px;
      font-size: 1.8em;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      z-index: 1001;
    }

    /* Side menu */
    .side-menu {
      position: fixed;
      top: 0;
      left: -240px;
      width: 220px;
      height: 100%;
      background: #2a2d38;
      padding-top: 60px;
      transition: left 0.3s;
      z-index: 1000;
      display: flex;
      flex-direction: column;
    }
    .side-menu a {
      padding: 15px 20px;
      text-decoration: none;
      color: white;
      font-weight: bold;
      border-bottom: 1px solid #444;
      text-align: left;
    }
    .side-menu a:hover {
      background: #6C63FF;
    }
    .side-menu.open {
      left: 0;
    }
	.logo-under-timer {
  width: 160px;   /* independent size */
  height: auto;
  margin-top: 12px;
}
.sponsor-footer {
  margin-top: 40px;
  padding: 15px;
  text-align: center;
  border-top: 1px solid #444;
}

.sponsor-logos {
  display: flex;
  justify-content: center;
  gap: 20px;
}

.sponsor-logos img {
  height: 60px;   /* adjust size */
  width: auto;
  filter: brightness(0.9); /* slightly dim for balance */
}
  </style>
</head>
<body>

  <!-- Hamburger button -->
  <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>

  <!-- Side menu -->
  <div id="sideMenu" class="side-menu">
    <a href="#" onclick="openGame('bingo.html')">üé≤ Bingo</a>
    <a href="#" onclick="openGame('quiz.html')">‚ùì Quiz</a>
    <a href="#" onclick="openGame('location.html')">üåç Guess the Location</a>
    <a href="#" onclick="openGame('easter.html')">ü•ö Found the Easter Eggs</a>
  </div>

  <div class="container">
    <div class="welcome-wrapper">
      <h1 id="welcome">Hej, spelare!</h1>
      <img src="viking.png" alt="right decoration" class="welcome-img">
    </div>
    <div class="timer">Tid kvar att spela: <span id="countdown">--:--:--</span></div>
<img src="logo.png" alt="left decoration" class="logo-under-timer">

<div class="game-card">
  <h3>üï∞Ô∏è Times to keep</h3>
  <p style="font-size:0.95em; color:#ccc; line-height:1.4;">
    H√§r hittar du tiderna att minnas under festen:<br><br>
    ‚Ä¢ 17:00 ‚Äì Start och v√§lkomstdrink üçπ<br>
    ‚Ä¢ 18:30 ‚Äì Middag serveras üçΩÔ∏è<br>
    ‚Ä¢ 20:00 ‚Äì Bingo startar üé≤<br>
    ‚Ä¢ 22:00 ‚Äì Quiz och √∂verraskningar ‚ùì<br>
    ‚Ä¢ 23:30 ‚Äì Gemensam sk√•l f√∂r Ingrid ü•Ç
  </p>
</div>


    <!-- Gallery stays visible -->
    <div class="game-card">
      <h3>üì∑ Gallery</h3>
      <p>Ta en bild och ladda upp</p>
      <input type="file" id="photoUpload" accept="image/*" capture="environment" style="margin-top:10px;">
      <p style="margin-top:10px; font-size:0.9em; color:#ccc;">
        Totalt antal bilder: <span id="photoCount">0</span>
      </p>
      <button onclick="viewGallery()">Se galleriet</button>
    </div>
  </div>

  <script>
  // Sheety base URL
  const API_URL = "https://api.sheety.co/19d52e6f83ab4563121d3da380c48d62/bingoPlayers/blad1";
  const params = new URLSearchParams(window.location.search);
  const playerId = params.get("id");

  // Cloudinary
  const CLOUD_NAME = "dtweoqypu";        
  const UPLOAD_PRESET = "Ingrid80";      

  // =========================
  // Side menu toggle
  // =========================
  function toggleMenu() {
    document.getElementById("sideMenu").classList.toggle("open");
  }

  // =========================
  // Fetch Player Info
  // =========================
  async function fetchPlayer() {
    try {
      let res = await fetch(API_URL);
      let data = await res.json();
      let sheetKey = Object.keys(data)[0]; // "blad1"
      let player = data[sheetKey].find(r => r.id == playerId);

      if (player) {
        document.getElementById("welcome").textContent = "Hej, " + player.name + "!";
      }
    } catch (err) {
      console.error("Error fetching player:", err);
    }
  }

  // =========================
  // Count Photos
  // =========================
  async function updatePhotoCount() {
    try {
      let res = await fetch(API_URL);
      let data = await res.json();
      let sheetKey = Object.keys(data)[0];
      let rows = data[sheetKey];

      let totalImages = 0;
      rows.forEach(r => {
        if (r.gallery) {
          try {
            let arr = JSON.parse(r.gallery);
            totalImages += arr.length;
          } catch (e) {
            totalImages += 1;
          }
        }
      });
      document.getElementById("photoCount").textContent = totalImages;

    } catch (err) {
      console.error("Error counting photos:", err);
    }
  }

  // =========================
  // Upload Photo
  // =========================
  async function uploadPhoto(file) {
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", UPLOAD_PRESET);

    let res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
      method: "POST",
      body: formData
    });

    let json = await res.json();
    let imageUrl = json.secure_url;

    let res2 = await fetch(`${API_URL}/${playerId}`);
    let data = await res2.json();
    let sheetKey = Object.keys(data)[0];
    let player = data[sheetKey];

    let gallery = [];
    try {
      gallery = JSON.parse(player.gallery || "[]");
    } catch (e) {
      gallery = [];
    }

    gallery.push(imageUrl);

    await fetch(`${API_URL}/${playerId}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        blad1: { gallery: JSON.stringify(gallery) }
      })
    });

    alert("Bilden har laddats upp!");
    updatePhotoCount();
  }

  document.getElementById("photoUpload").addEventListener("change", function() {
    if (this.files && this.files[0]) {
      uploadPhoto(this.files[0]);
    }
  });

  // =========================
  // Navigation
  // =========================
  function viewGallery() {
    window.location.href = "gallery.html?id=" + playerId;
  }

  window.openGame = function (url) {
    toggleMenu(); // close menu after selecting
    window.location.href = url + "?id=" + encodeURIComponent(playerId);
  };

  // =========================
  // Countdown Timer
  // =========================
  const reviewDate = new Date("2025-10-10T18:00:00").getTime();
  function updateCountdown() {
    const now = new Date().getTime();
    const diff = reviewDate - now;

    if (diff <= 0) {
      document.getElementById("countdown").textContent = "Tiden √§r slut!";
      clearInterval(timerInterval);
      return;
    }

    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

    let text = "";
    if (days > 0) text += days + "d ";
    text += (hours < 10 ? "0" + hours : hours) + ":"
          + (minutes < 10 ? "0" + minutes : minutes) + ":"
          + (seconds < 10 ? "0" + seconds : seconds);

    document.getElementById("countdown").textContent = text;
  }
  const timerInterval = setInterval(updateCountdown, 1000);
  updateCountdown();

  // =========================
  // Init
  // =========================
  fetchPlayer();
  updatePhotoCount();
  </script>
  <footer class="sponsor-footer">
  <p style="margin-bottom:10px; color:#ccc;">Sponsored by</p>
  <div class="sponsor-logos">
    <img src="sponsor1.png" alt="Sponsor 1">
    <img src="sponsor2.png" alt="Sponsor 2">
    <img src="sponsor3.png" alt="Sponsor 3">
  </div>
</footer>

</body>
</html>
